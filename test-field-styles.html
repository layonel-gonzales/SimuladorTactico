<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Sistema de Estilos de Cancha</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/estilo.css">
    <style>
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .test-canvas {
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            margin: 10px 0;
        }
        .test-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-palette me-2"></i>
                    Test - Sistema de Estilos de Cancha
                </h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="test-section">
                    <h5><i class="fas fa-brush me-2"></i>Control de Estilos</h5>
                    
                    <div class="mb-3">
                        <label for="style-selector" class="form-label">Seleccionar Estilo:</label>
                        <select id="style-selector" class="form-select">
                            <option value="original">üèüÔ∏è Original</option>
                            <option value="classic">‚öΩ Cl√°sico</option>
                            <option value="modern">üåü Moderno</option>
                            <option value="night">üåô Nocturno</option>
                            <option value="retro">üï∞Ô∏è Retro</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <button id="apply-style-btn" class="btn btn-primary w-100">
                            <i class="fas fa-check me-1"></i>Aplicar Estilo
                        </button>
                    </div>

                    <div class="mb-3">
                        <button id="open-modal-btn" class="btn btn-outline-info w-100">
                            <i class="fas fa-cogs me-1"></i>Abrir Modal
                        </button>
                    </div>

                    <div class="mb-3">
                        <button id="test-integration-btn" class="btn btn-outline-success w-100">
                            <i class="fas fa-plug me-1"></i>Test Integraci√≥n
                        </button>
                    </div>
                </div>

                <div class="test-section">
                    <h6><i class="fas fa-info-circle me-2"></i>Estado del Sistema</h6>
                    <div id="system-status">
                        <div class="small text-muted">Cargando...</div>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="test-section">
                    <h5><i class="fas fa-eye me-2"></i>Preview de Estilos</h5>
                    <div class="text-center">
                        <canvas id="test-canvas" class="test-canvas" width="400" height="240"></canvas>
                    </div>
                </div>

                <div class="test-section">
                    <h6><i class="fas fa-terminal me-2"></i>Log de Eventos</h6>
                    <div id="event-log" style="height: 200px; overflow-y: auto; background: var(--bg-tertiary); padding: 10px; border-radius: 6px; font-family: monospace; font-size: 12px;">
                        <!-- Logs aparecer√°n aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- M√≥dulos del Sistema -->
    <script type="module">
        import FieldStyleManager from './js/fieldStyleManager.js';
        import FieldStyleIntegration from './js/fieldStyleIntegration.js';

        // Variables globales
        let fieldStyleManager;
        let fieldStyleIntegration;
        let testCanvas;
        let testCtx;

        // Funci√≥n para agregar logs
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#17a2b8';
            
            logContainer.innerHTML += `<div style="color: ${color}; margin-bottom: 4px;">[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Funci√≥n para actualizar estado del sistema
        function updateSystemStatus() {
            const statusContainer = document.getElementById('system-status');
            
            const status = {
                'FieldStyleManager': !!window.fieldStyleManager,
                'FieldStyleIntegration': !!window.fieldStyleIntegration,
                'Estilos Disponibles': window.fieldStyleManager ? window.fieldStyleManager.getAvailableStyles().length : 0,
                'Estilo Actual': window.fieldStyleManager ? window.fieldStyleManager.getCurrentStyle() : 'N/A'
            };

            statusContainer.innerHTML = Object.entries(status).map(([key, value]) => {
                const color = typeof value === 'boolean' ? (value ? 'text-success' : 'text-danger') : 'text-info';
                const icon = typeof value === 'boolean' ? (value ? 'fa-check-circle' : 'fa-times-circle') : 'fa-info-circle';
                return `<div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="small">${key}:</span>
                    <span class="${color}"><i class="fas ${icon} me-1"></i>${value}</span>
                </div>`;
            }).join('');
        }

        // Inicializaci√≥n
        async function init() {
            try {
                addLog('üöÄ Iniciando test del sistema de estilos...', 'info');

                // Inicializar canvas de test
                testCanvas = document.getElementById('test-canvas');
                testCtx = testCanvas.getContext('2d');

                // Crear instancias
                fieldStyleManager = new FieldStyleManager();
                fieldStyleIntegration = new FieldStyleIntegration();

                // Exponerlos globalmente
                window.fieldStyleManager = fieldStyleManager;
                window.fieldStyleIntegration = fieldStyleIntegration;

                addLog('‚úÖ FieldStyleManager inicializado', 'success');
                addLog('‚úÖ FieldStyleIntegration inicializado', 'success');

                // Configurar event listeners
                setupEventListeners();

                // Actualizar estado inicial
                updateSystemStatus();

                // Dibujar estilo inicial
                updateTestCanvas();

                addLog('üé® Sistema de estilos listo para pruebas', 'success');

            } catch (error) {
                addLog(`‚ùå Error en inicializaci√≥n: ${error.message}`, 'error');
                console.error('Error en test:', error);
            }
        }

        function setupEventListeners() {
            // Selector de estilos
            const styleSelector = document.getElementById('style-selector');
            styleSelector.addEventListener('change', (e) => {
                const styleId = e.target.value;
                addLog(`üé® Cambiando a estilo: ${styleId}`, 'info');
                
                if (fieldStyleManager) {
                    fieldStyleManager.setStyle(styleId);
                    updateTestCanvas();
                    updateSystemStatus();
                }
            });

            // Bot√≥n aplicar estilo
            const applyBtn = document.getElementById('apply-style-btn');
            applyBtn.addEventListener('click', () => {
                const selectedStyle = styleSelector.value;
                addLog(`‚úÖ Aplicando estilo: ${selectedStyle}`, 'success');
                
                if (fieldStyleManager) {
                    fieldStyleManager.setStyle(selectedStyle);
                    updateTestCanvas();
                    
                    // Mostrar notificaci√≥n
                    fieldStyleIntegration.showNotification(`Estilo "${selectedStyle}" aplicado correctamente`);
                }
            });

            // Bot√≥n abrir modal
            const modalBtn = document.getElementById('open-modal-btn');
            modalBtn.addEventListener('click', () => {
                addLog('üîß Abriendo modal de configuraci√≥n...', 'info');
                
                if (fieldStyleIntegration) {
                    fieldStyleIntegration.openFieldStyleModal();
                }
            });

            // Bot√≥n test integraci√≥n
            const testBtn = document.getElementById('test-integration-btn');
            testBtn.addEventListener('click', () => {
                addLog('üß™ Ejecutando test de integraci√≥n...', 'warning');
                
                if (fieldStyleIntegration) {
                    fieldStyleIntegration.manualIntegration();
                    addLog('‚úÖ Test de integraci√≥n completado', 'success');
                } else {
                    addLog('‚ùå FieldStyleIntegration no disponible', 'error');
                }
            });

            // Event listeners del sistema
            document.addEventListener('fieldStyleChanged', (e) => {
                const { styleId, styleName } = e.detail;
                addLog(`üé≠ Evento: Estilo cambiado a ${styleName} (${styleId})`, 'info');
                updateSystemStatus();
            });

            document.addEventListener('fieldStylesLoaded', (e) => {
                const { styles } = e.detail;
                addLog(`üìö Evento: ${styles.length} estilos cargados`, 'info');
                updateSystemStatus();
            });
        }

        function updateTestCanvas() {
            if (!fieldStyleManager || !testCanvas || !testCtx) return;

            try {
                const currentStyle = fieldStyleManager.getCurrentStyle();
                addLog(`üñºÔ∏è Actualizando canvas con estilo: ${currentStyle}`, 'info');
                
                fieldStyleManager.previewStyle(currentStyle, testCanvas, testCtx);
                
            } catch (error) {
                addLog(`‚ùå Error actualizando canvas: ${error.message}`, 'error');
            }
        }

        // Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Actualizar estado cada 5 segundos
        setInterval(updateSystemStatus, 5000);
    </script>
</body>
</html>
