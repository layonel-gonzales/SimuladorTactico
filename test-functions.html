<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Funcionalidades - Simulador T√°ctico</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #1a1a1a; 
            color: white; 
        }
        .test-result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px; 
        }
        .pass { background-color: #28a745; }
        .fail { background-color: #dc3545; }
        .warn { background-color: #ffc107; color: black; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        #results { margin-top: 20px; }
        .test-section { 
            border: 1px solid #444; 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 8px; 
        }
    </style>
</head>
<body>
    <h1>üß™ Test Automatizado - Simulador T√°ctico</h1>
    <p>Esta p√°gina ejecuta pruebas autom√°ticas de todas las funcionalidades del simulador.</p>
    
    <button onclick="runAllTests()">üöÄ Ejecutar Todas las Pruebas</button>
    <button onclick="clearResults()">üóëÔ∏è Limpiar Resultados</button>
    
    <div id="results"></div>

    <script>
        let testResults = [];
        
        function addResult(testName, status, message, details = '') {
            testResults.push({ testName, status, message, details });
            renderResults();
        }
        
        function renderResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = testResults.map(result => `
                <div class="test-result ${result.status}">
                    <strong>${result.testName}</strong>: ${result.message}
                    ${result.details ? `<br><small>${result.details}</small>` : ''}
                </div>
            `).join('');
        }
        
        function clearResults() {
            testResults = [];
            renderResults();
        }
        
        // TEST 1: Verificar archivos HTML
        function testHTMLElements() {
            const requiredElements = [
                'global-mode-toggle',
                'global-select-squad-btn', 
                'fullscreen-toggle-btn',
                'drawing-mode-controls',
                'animation-mode-controls',
                'football-field',
                'drawing-canvas',
                'pitch-container'
            ];
            
            let missingElements = [];
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    missingElements.push(id);
                }
            });
            
            if (missingElements.length === 0) {
                addResult('HTML Elements', 'pass', 'Todos los elementos HTML requeridos est√°n presentes');
            } else {
                addResult('HTML Elements', 'fail', `Faltan ${missingElements.length} elementos`, 
                         `Elementos faltantes: ${missingElements.join(', ')}`);
            }
        }
        
        // TEST 2: Verificar archivos JavaScript
        function testJSModules() {
            const jsFiles = [
                'js/main.js',
                'js/playerManager.js', 
                'js/drawingManager.js',
                'js/animationManager.js',
                'js/uiManager.js',
                'js/modeManager.js',
                'js/audioManager.js',
                'js/ballDrawingManager.js',
                'js/tutorialManager.js',
                'js/fullscreenManager.js',
                'js/orientationManager.js',
                'js/shareManager.js',
                'js/fieldDrawer.js',
                'js/players.js',
                'js/utils.js'
            ];
            
            let loadedModules = 0;
            let promises = [];
            
            jsFiles.forEach(file => {
                promises.push(
                    fetch(file)
                        .then(response => {
                            if (response.ok) loadedModules++;
                            return response.ok;
                        })
                        .catch(() => false)
                );
            });
            
            Promise.all(promises).then(results => {
                const failedFiles = jsFiles.filter((file, index) => !results[index]);
                
                if (loadedModules === jsFiles.length) {
                    addResult('JavaScript Modules', 'pass', `Todos los ${jsFiles.length} m√≥dulos JS est√°n disponibles`);
                } else {
                    addResult('JavaScript Modules', 'fail', 
                             `${loadedModules}/${jsFiles.length} m√≥dulos cargados`, 
                             `Archivos faltantes: ${failedFiles.join(', ')}`);
                }
            });
        }
        
        // TEST 3: Verificar CSS
        function testCSS() {
            fetch('css/estilo.css')
                .then(response => {
                    if (response.ok) {
                        addResult('CSS Styles', 'pass', 'Archivo de estilos principal cargado correctamente');
                    } else {
                        addResult('CSS Styles', 'fail', 'No se pudo cargar el archivo de estilos principal');
                    }
                })
                .catch(() => {
                    addResult('CSS Styles', 'fail', 'Error al verificar archivo de estilos');
                });
        }
        
        // TEST 4: Verificar im√°genes
        function testImages() {
            const images = [
                'img/ball.png',
                'img/default_player.png', 
                'img/logoStoiko.png',
                'img/marco.png',
                'img/marco3.png',
                'img/rotate-device.png'
            ];
            
            let loadedImages = 0;
            let promises = [];
            
            images.forEach(imgSrc => {
                const img = new Image();
                const promise = new Promise(resolve => {
                    img.onload = () => {
                        loadedImages++;
                        resolve(true);
                    };
                    img.onerror = () => resolve(false);
                    img.src = imgSrc;
                });
                promises.push(promise);
            });
            
            Promise.all(promises).then(results => {
                const failedImages = images.filter((img, index) => !results[index]);
                
                if (loadedImages === images.length) {
                    addResult('Images', 'pass', `Todas las ${images.length} im√°genes se cargaron correctamente`);
                } else {
                    addResult('Images', 'warn', 
                             `${loadedImages}/${images.length} im√°genes cargadas`, 
                             `Im√°genes faltantes: ${failedImages.join(', ')}`);
                }
            });
        }
        
        // TEST 5: Verificar dependencias externas
        function testExternalDependencies() {
            const dependencies = [
                { name: 'Bootstrap CSS', url: 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' },
                { name: 'Bootstrap JS', url: 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js' },
                { name: 'Font Awesome', url: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css' },
                { name: 'Intro.js CSS', url: 'https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/introjs.min.css' },
                { name: 'Intro.js JS', url: 'https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/intro.min.js' }
            ];
            
            let loadedDeps = 0;
            dependencies.forEach(dep => {
                fetch(dep.url, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            loadedDeps++;
                            if (loadedDeps === dependencies.length) {
                                addResult('External Dependencies', 'pass', 'Todas las dependencias externas est√°n disponibles');
                            }
                        }
                    })
                    .catch(() => {
                        addResult('External Dependencies', 'warn', `${dep.name} no disponible`, 
                                 'Verifica tu conexi√≥n a internet');
                    });
            });
            
            // Timeout para detectar problemas de conectividad
            setTimeout(() => {
                if (loadedDeps < dependencies.length) {
                    addResult('External Dependencies', 'warn', 
                             `Solo ${loadedDeps}/${dependencies.length} dependencias cargadas`,
                             'Puede haber problemas de conectividad');
                }
            }, 5000);
        }
        
        // TEST 6: Simular interacciones b√°sicas
        function testBasicInteractions() {
            // Verificar que los botones respondan
            const buttons = [
                'global-mode-toggle',
                'global-select-squad-btn',
                'fullscreen-toggle-btn'
            ];
            
            let workingButtons = 0;
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button && typeof button.click === 'function') {
                    workingButtons++;
                }
            });
            
            if (workingButtons === buttons.length) {
                addResult('Basic Interactions', 'pass', 'Todos los botones principales son interactuables');
            } else {
                addResult('Basic Interactions', 'fail', 
                         `${workingButtons}/${buttons.length} botones funcionales`);
            }
        }
        
        // TEST 7: Verificar Canvas
        function testCanvas() {
            const footballField = document.getElementById('football-field');
            const drawingCanvas = document.getElementById('drawing-canvas');
            
            let canvasIssues = [];
            
            if (!footballField) {
                canvasIssues.push('Canvas del campo de f√∫tbol no encontrado');
            } else if (!footballField.getContext) {
                canvasIssues.push('Canvas del campo no soporta 2D context');
            }
            
            if (!drawingCanvas) {
                canvasIssues.push('Canvas de dibujo no encontrado');
            } else if (!drawingCanvas.getContext) {
                canvasIssues.push('Canvas de dibujo no soporta 2D context');
            }
            
            if (canvasIssues.length === 0) {
                addResult('Canvas Support', 'pass', 'Ambos canvas est√°n disponibles y soportan 2D');
            } else {
                addResult('Canvas Support', 'fail', 'Problemas con canvas', canvasIssues.join(', '));
            }
        }
        
        // TEST 8: Verificar APIs del navegador
        function testBrowserAPIs() {
            const apis = [
                { name: 'Local Storage', check: () => typeof Storage !== 'undefined' },
                { name: 'MediaRecorder', check: () => typeof MediaRecorder !== 'undefined' },
                { name: 'getUserMedia', check: () => navigator.mediaDevices && navigator.getUserMedia },
                { name: 'Fullscreen API', check: () => document.fullscreenEnabled !== undefined },
                { name: 'File API', check: () => typeof FileReader !== 'undefined' },
                { name: 'Blob API', check: () => typeof Blob !== 'undefined' },
                { name: 'URL.createObjectURL', check: () => typeof URL !== 'undefined' && URL.createObjectURL }
            ];
            
            let supportedAPIs = 0;
            let unsupportedAPIs = [];
            
            apis.forEach(api => {
                try {
                    if (api.check()) {
                        supportedAPIs++;
                    } else {
                        unsupportedAPIs.push(api.name);
                    }
                } catch (e) {
                    unsupportedAPIs.push(api.name);
                }
            });
            
            if (supportedAPIs === apis.length) {
                addResult('Browser APIs', 'pass', 'Todas las APIs del navegador est√°n disponibles');
            } else {
                const status = supportedAPIs >= apis.length * 0.7 ? 'warn' : 'fail';
                addResult('Browser APIs', status, 
                         `${supportedAPIs}/${apis.length} APIs soportadas`,
                         `APIs no disponibles: ${unsupportedAPIs.join(', ')}`);
            }
        }
        
        // Funci√≥n principal para ejecutar todos los tests
        async function runAllTests() {
            clearResults();
            addResult('Test Status', 'pass', 'üöÄ Iniciando pruebas automatizadas...');
            
            // Ejecutar tests secuencialmente
            testHTMLElements();
            testCanvas();
            testBrowserAPIs();
            testBasicInteractions();
            
            // Ejecutar tests as√≠ncronos
            await new Promise(resolve => setTimeout(resolve, 100));
            testJSModules();
            testCSS();
            testImages();
            testExternalDependencies();
            
            // Resumen final despu√©s de un delay
            setTimeout(() => {
                const totalTests = testResults.length - 1; // Excluir mensaje inicial
                const passedTests = testResults.filter(r => r.status === 'pass').length - 1;
                const failedTests = testResults.filter(r => r.status === 'fail').length;
                const warningTests = testResults.filter(r => r.status === 'warn').length;
                
                const finalStatus = failedTests === 0 ? 'pass' : (failedTests < 3 ? 'warn' : 'fail');
                addResult('üìä Resumen Final', finalStatus, 
                         `‚úÖ ${passedTests} pasaron, ‚ö†Ô∏è ${warningTests} advertencias, ‚ùå ${failedTests} fallaron`);
            }, 6000);
        }
        
        // Auto-ejecutar tests al cargar la p√°gina
        window.onload = () => {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>
