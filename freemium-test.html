<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fr        <!-- Tests Adicionales -->
        <div class="test-card">
            <h3>üîß Pruebas Adicionales</h3>
            <button class="btn btn-secondary btn-test" onclick="testConfigManager()">Probar ConfigManager</button>
            <button class="btn btn-success btn-test" onclick="testFullSystem()">Probar Sistema Completo</button>
            <button class="btn btn-danger btn-test" onclick="showModal('lines')">Modal Upgrade</button>
        </div>
        
        <!-- Tutorial Tests -->
        <div class="test-card">
            <h3>üéì Pruebas de Tutorial</h3>
            <button class="btn btn-primary btn-test" onclick="testTutorial('freemiumIntro')">Tutorial Intro</button>
            <button class="btn btn-warning btn-test" onclick="testTutorial('drawingLimits')">Tutorial Dibujo</button>
            <button class="btn btn-info btn-test" onclick="testTutorial('upgradePrompt')">Tutorial Upgrade</button>
        </div>System - Simulador T√°ctico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/freemium-styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-card h3 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .btn-test {
            margin: 5px;
            border-radius: 20px;
            padding: 8px 20px;
            font-weight: 600;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-ok {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="text-center mb-4">
            <h1 class="text-white">üß™ Test Freemium System</h1>
            <p class="text-white-50">Simulador T√°ctico - Pruebas de Funcionalidad</p>
        </div>
        
        <!-- Estado del Sistema -->
        <div class="test-card">
            <h3>üìä Estado del Sistema</h3>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>FreemiumConfigManager:</strong> <span id="config-manager-status">Cargando...</span></p>
                    <p><strong>FreemiumController:</strong> <span id="controller-status">Cargando...</span></p>
                    <p><strong>PaymentManager:</strong> <span id="payment-status">Cargando...</span></p>
                    <p><strong>Plan Actual:</strong> <span id="current-plan">Cargando...</span></p>
                </div>
                <div class="col-md-6">
                    <p><strong>Tutorial System:</strong> <span id="tutorial-status">Cargando...</span></p>
                    <p><strong>Servidor Backend:</strong> <span id="server-status">Cargando...</span></p>
                    <p><strong>√öltima Actualizaci√≥n:</strong> <span id="last-update">‚Äî</span></p>
                </div>
            </div>
        </div>
        
        <!-- Pruebas de L√≠mites de Dibujo -->
        <div class="test-card">
            <h3>üé® Pruebas de L√≠mites de Dibujo</h3>
            <button class="btn btn-primary btn-test" onclick="testDrawingLimits()">Probar L√≠mite de L√≠neas</button>
            <button class="btn btn-warning btn-test" onclick="testColorLimits()">Probar L√≠mite de Colores</button>
            <button class="btn btn-info btn-test" onclick="testFormationLimits()">Probar Formaciones</button>
            <div id="drawing-results" class="result-box" style="display: none;"></div>
        </div>
        
        <!-- Pruebas de Animaci√≥n -->
        <div class="test-card">
            <h3>üé¨ Pruebas de Animaci√≥n</h3>
            <button class="btn btn-primary btn-test" onclick="testAnimationDuration()">Probar Duraci√≥n</button>
            <button class="btn btn-warning btn-test" onclick="testAnimationFrames()">Probar Frames</button>
            <button class="btn btn-danger btn-test" onclick="testAudioRecording()">Probar Audio</button>
            <div id="animation-results" class="result-box" style="display: none;"></div>
        </div>
        
        <!-- Pruebas de Guardado -->
        <div class="test-card">
            <h3>üíæ Pruebas de Guardado</h3>
            <button class="btn btn-primary btn-test" onclick="testPlayerLoading()">Probar Carga de Jugadores</button>
            <button class="btn btn-warning btn-test" onclick="testExportLimits()">Probar Exportaci√≥n</button>
            <button class="btn btn-info btn-test" onclick="testJSONExport()">Probar JSON Export</button>
            <div id="saving-results" class="result-box" style="display: none;"></div>
        </div>
        
        <!-- Pruebas de Modales -->
        <div class="test-card">
            <h3>üíé Pruebas de Modales de Upgrade</h3>
            <button class="btn btn-primary btn-test" onclick="showModal('drawing_limit')">Modal Dibujo</button>
            <button class="btn btn-warning btn-test" onclick="showModal('animation_limit')">Modal Animaci√≥n</button>
            <button class="btn btn-info btn-test" onclick="showModal('animation_limit')">Modal Animaciones</button>
            <button class="btn btn-success btn-test" onclick="showModal('color_limit')">Modal Colores</button>
            <button class="btn btn-danger btn-test" onclick="showModal('audio_limit')">Modal Audio</button>
        </div>
        
        <!-- Progreso de Uso -->
        <div class="test-card">
            <h3>üìà Indicadores de Progreso</h3>
            <div id="progress-container">
                <div class="freemium-progress-container">
                    <div class="freemium-progress-label">L√≠neas: 3/5</div>
                    <div class="freemium-progress-bar">
                        <div class="freemium-progress-fill" style="width: 60%"></div>
                    </div>
                </div>
                <div class="freemium-progress-container">
                    <div class="freemium-progress-label">T√°cticas: 2/3</div>
                    <div class="freemium-progress-bar">
                        <div class="freemium-progress-fill warning" style="width: 67%"></div>
                    </div>
                </div>
                <div class="freemium-progress-container">
                    <div class="freemium-progress-label">Dispositivos: 3/3</div>
                    <div class="freemium-progress-bar">
                        <div class="freemium-progress-fill limit-reached" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tutorial Tests -->
        <div class="test-card">
            <h3>üìö Pruebas de Tutorial</h3>
            <button class="btn btn-primary btn-test" onclick="testTutorial('freemiumIntro')">Tutorial Intro</button>
            <button class="btn btn-warning btn-test" onclick="testTutorial('drawingLimits')">Tutorial Dibujo</button>
            <button class="btn btn-info btn-test" onclick="testTutorial('upgradePrompt')">Tutorial Upgrade</button>
        </div>
        
        <!-- Log de Eventos -->
        <div class="test-card">
            <h3>üìù Log de Eventos</h3>
            <button class="btn btn-secondary btn-test" onclick="clearLog()">Limpiar Log</button>
            <button class="btn btn-primary btn-test" onclick="refreshStatus()">Actualizar Estado</button>
            <div id="event-log" class="result-box" style="display: block; max-height: 300px; overflow-y: auto;">
                <div class="text-muted">Esperando eventos...</div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/freemiumConfigManager.js"></script>
    <script src="js/paymentManager.js"></script>
    <script src="js/freemiumController.js"></script>
    <script src="js/freemiumTutorial.js"></script>
    
    <script>
        // Test Functions
        function log(message, type = 'info') {
            const logContainer = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type === 'error' ? 'text-danger' : 
                            type === 'warning' ? 'text-warning' : 
                            type === 'success' ? 'text-success' : 'text-info';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> <span class="${typeClass}">${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('event-log').innerHTML = '<div class="text-muted">Log limpiado...</div>';
        }
        
        function updateStatus(elementId, status, isOk = true) {
            const element = document.getElementById(elementId);
            const badge = isOk ? 'status-ok' : 'status-error';
            element.innerHTML = `${status} <span class="status-badge ${badge}">${isOk ? 'OK' : 'ERROR'}</span>`;
        }
        
        function refreshStatus() {
            log('Actualizando estado del sistema...', 'info');
            
            // Check FreemiumConfigManager
            if (window.freemiumConfigManager) {
                updateStatus('config-manager-status', 'Cargado', true);
                const configInfo = freemiumConfigManager.getConfigInfo();
                log(`FreemiumConfigManager detectado: ${configInfo.plansCount} planes, ${configInfo.categoriesCount} categor√≠as`, 'success');
            } else {
                updateStatus('config-manager-status', 'No disponible', false);
                log('FreemiumConfigManager no encontrado', 'error');
            }
            
            // Check FreemiumController
            if (window.freemiumController) {
                updateStatus('controller-status', 'Cargado', true);
                const plan = freemiumController.getPlanName();
                document.getElementById('current-plan').textContent = plan.toUpperCase();
                log('FreemiumController detectado: Plan ' + plan, 'success');
            } else {
                updateStatus('controller-status', 'No disponible', false);
                log('FreemiumController no encontrado', 'error');
            }
            
            // Check PaymentManager
            if (window.paymentManager) {
                updateStatus('payment-status', 'Cargado', true);
                log('PaymentManager detectado', 'success');
            } else {
                updateStatus('payment-status', 'No disponible', false);
                log('PaymentManager no encontrado', 'error');
            }
            
            // Check Tutorial
            if (window.freemiumTutorial) {
                updateStatus('tutorial-status', 'Cargado', true);
                log('FreemiumTutorial detectado', 'success');
            } else {
                updateStatus('tutorial-status', 'No disponible', false);
                log('FreemiumTutorial no encontrado', 'error');
            }
            
            // Server status (test connectivity)
            testServerConnection();
            
            document.getElementById('last-update').textContent = new Date().toLocaleString();
            log('Estado actualizado correctamente', 'success');
        }
        
        async function testServerConnection() {
            try {
                if (window.freemiumConfigManager) {
                    const isConnected = await freemiumConfigManager.checkServerConnection();
                    updateStatus('server-status', isConnected ? 'Conectado' : 'Desconectado', isConnected);
                    log(`Servidor: ${isConnected ? 'Conectado' : 'Desconectado'}`, isConnected ? 'success' : 'warning');
                } else {
                    updateStatus('server-status', 'No probado', false);
                    log('No se pudo probar conexi√≥n al servidor', 'warning');
                }
            } catch (error) {
                updateStatus('server-status', 'Error', false);
                log('Error probando servidor: ' + error.message, 'error');
            }
        }
        
        // Test Functions
        async function testDrawingLimits() {
            log('Probando l√≠mites de dibujo...', 'info');
            const resultBox = document.getElementById('drawing-results');
            resultBox.style.display = 'block';
            
            if (!window.freemiumController) {
                resultBox.innerHTML = 'ERROR: FreemiumController no disponible';
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const results = [];
            
            // Simular verificaci√≥n de l√≠neas
            for (let i = 1; i <= 7; i++) {
                freemiumController.currentCounts.lines = i - 1;
                const canDraw = freemiumController.canDrawLine();
                results.push(`L√≠nea ${i}: ${canDraw ? '‚úÖ Permitido' : '‚ùå Bloqueado'}`);
                log(`L√≠nea ${i}: ${canDraw ? 'Permitido' : 'Bloqueado'}`, canDraw ? 'success' : 'warning');
            }
            
            resultBox.innerHTML = results.join('<br>');
        }
        
        async function testColorLimits() {
            log('Probando l√≠mites de colores...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const colors = ['#ff0000', '#0000ff', '#00ff00', '#ffff00', '#ff00ff'];
            const results = [];
            
            colors.forEach(color => {
                const canUse = freemiumController.canUseColor(color);
                results.push(`Color ${color}: ${canUse ? '‚úÖ Permitido' : '‚ùå Bloqueado'}`);
                log(`Color ${color}: ${canUse ? 'Permitido' : 'Bloqueado'}`, canUse ? 'success' : 'warning');
            });
            
            const resultBox = document.getElementById('drawing-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = results.join('<br>');
        }
        
        async function testFormationLimits() {
            log('Probando l√≠mites de formaciones...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const formations = ['4-4-2', '4-3-3', '3-5-2', '4-2-3-1', '5-3-2'];
            const results = [];
            
            formations.forEach(formation => {
                const canUse = freemiumController.canUseFormation(formation);
                results.push(`${formation}: ${canUse ? '‚úÖ Permitido' : '‚ùå Bloqueado'}`);
                log(`Formaci√≥n ${formation}: ${canUse ? 'Permitido' : 'Bloqueado'}`, canUse ? 'success' : 'warning');
            });
            
            const resultBox = document.getElementById('drawing-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = results.join('<br>');
        }
        
        async function testAnimationDuration() {
            log('Probando l√≠mites de duraci√≥n...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const durations = [5, 10, 15, 30, 60];
            const results = [];
            
            durations.forEach(duration => {
                const canExtend = freemiumController.canExtendAnimationDuration(duration);
                results.push(`${duration}s: ${canExtend ? '‚úÖ Permitido' : '‚ùå Bloqueado'}`);
                log(`Duraci√≥n ${duration}s: ${canExtend ? 'Permitido' : 'Bloqueado'}`, canExtend ? 'success' : 'warning');
            });
            
            const resultBox = document.getElementById('animation-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = results.join('<br>');
        }
        
        async function testAnimationFrames() {
            log('Probando l√≠mites de frames...', 'info');
            
            const resultBox = document.getElementById('animation-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = 'Funci√≥n de frames simulada: M√°ximo 5 frames en plan gratuito';
            log('Test de frames completado (simulado)', 'info');
        }
        
        async function testAudioRecording() {
            log('Probando grabaci√≥n de audio...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const canRecord = freemiumController.canRecordAudio();
            const result = `Grabaci√≥n de audio: ${canRecord ? '‚úÖ Permitido' : '‚ùå Bloqueado (Premium requerido)'}`;
            
            const resultBox = document.getElementById('animation-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = result;
            
            log(result, canRecord ? 'success' : 'warning');
        }
        
        async function testPlayerLoading() {
            log('Probando carga de jugadores con formaciones...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }

            const formations = freemiumController.getFeatureValue('formations');
            const availableFormations = Array.isArray(formations) ? formations.length : (formations === 'all' ? 'Todas' : formations);
            const result = `Formaciones disponibles: ${availableFormations}`;
            
            const resultBox = document.getElementById('saving-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = result;
            
            log(result, 'success');
        }
        
        async function testExportLimits() {
            log('Probando exportaci√≥n...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const canExportHD = freemiumController.canExportWithoutWatermark();
            const result = `Exportar sin marca de agua: ${canExportHD ? '‚úÖ Permitido' : '‚ùå Solo con marca de agua'}`;
            
            const resultBox = document.getElementById('saving-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = result;
            
            log(result, canExportHD ? 'success' : 'warning');
        }
        
        async function testJSONExport() {
            log('Probando exportaci√≥n JSON...', 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            const canExportJSON = freemiumController.canExportJSON();
            const result = `Exportar JSON: ${canExportJSON ? '‚úÖ Permitido' : '‚ùå Premium requerido'}`;
            
            const resultBox = document.getElementById('saving-results');
            resultBox.style.display = 'block';
            resultBox.innerHTML = result;
            
            log(result, canExportJSON ? 'success' : 'warning');
        }
        
        function showModal(type) {
            log(`Mostrando modal: ${type}`, 'info');
            
            if (!window.freemiumController) {
                log('Error: FreemiumController no disponible', 'error');
                return;
            }
            
            freemiumController.showUpgradeModal(type, { current: 3, max: 5 });
        }
        
        function testTutorial(tutorialName) {
            log(`Iniciando tutorial: ${tutorialName}`, 'info');
            
            if (!window.freemiumTutorial) {
                log('Error: FreemiumTutorial no disponible', 'error');
                return;
            }
            
            freemiumTutorial.showTutorial(tutorialName);
        }
        
        async function testConfigManager() {
            log('Probando FreemiumConfigManager...', 'info');
            
            if (!window.freemiumConfigManager) {
                log('Error: FreemiumConfigManager no est√° disponible', 'error');
                return;
            }
            
            try {
                // Test configuration loading
                const plan = freemiumConfigManager.getPlan('free');
                if (plan) {
                    log('‚úì Plan FREE cargado correctamente', 'success');
                    log(`  - L√≠neas permitidas: ${plan.features.maxLines?.value || 'N/A'}`, 'info');
                    log(`  - Colores permitidos: ${plan.features.maxColors?.value || 'N/A'}`, 'info');
                } else {
                    log('‚úó Error cargando plan FREE', 'error');
                }
                
                // Test feature values
                const maxLines = freemiumConfigManager.getFeatureValue('free', 'maxLines');
                const maxTactics = freemiumConfigManager.getFeatureValue('free', 'maxSavedTactics');
                const hasExport = freemiumConfigManager.getFeatureValue('free', 'canExport');
                
                log(`Valores de configuraci√≥n:`, 'info');
                log(`  - L√≠neas m√°ximas: ${maxLines}`, 'info');
                log(`  - T√°cticas m√°ximas: ${maxTactics}`, 'info');
                log(`  - Puede exportar: ${hasExport}`, 'info');
                
                // Test server connection
                const serverConnected = await freemiumConfigManager.checkServerConnection();
                log(`Conexi√≥n al servidor: ${serverConnected ? 'Conectado' : 'Desconectado'}`, 
                    serverConnected ? 'success' : 'warning');
                
                log('Prueba de ConfigManager completada', 'success');
                
            } catch (error) {
                log('Error en ConfigManager: ' + error.message, 'error');
            }
        }
        
        function testFullSystem() {
            log('Iniciando prueba completa del sistema...', 'info');
            
            // Reset all counters
            if (window.freemiumController) {
                freemiumController.resetCounters();
                log('Contadores reseteados', 'success');
            }
            
            // Test each component
            testConfigManager();
            setTimeout(() => testDrawingLimits(), 1000);
            setTimeout(() => testAnimationDuration(), 2000);
            setTimeout(() => testStorageLimits(), 3000);
            setTimeout(() => testTutorial('freemium-intro'), 4000);
            
            log('Prueba completa iniciada - revisa los resultados individuales', 'info');
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            log('P√°gina de pruebas cargada', 'success');
            setTimeout(refreshStatus, 1000);
        });
    </script>
</body>
</html>
